var data = require('./data.json');

module.exports = {
  simplified: function(text) {
    return convert(text, ["zh2CN", "zh2Hans"]);
  },
  traditional: function(text) {
    return convert(text, ["zh2TW", "zh2Hant"]);
  }
}

function convert(text, dicts) {
	var converted = "";
	var textLength = text.length;
	for (var position = 0; position < textLength; position++) {
		var convertedToken = text.charAt(position);
		for (var length=4; length >= 1; length--) { 
      var token = text.substring(position, position + length);
			newToken = tryConvertToken(token, dicts);
      if (newToken != false) {
        convertedToken = newToken;
				position += length - 1;   //The minus 1 is for compensating the position++ in the for loop
				break;
			}
		}
		converted += convertedToken;
	}
	return converted;
}

function tryConvertToken(token, dicts) {
	for (var i in dicts) {
    var dict = dicts[i];
    var val = data[dict][token];
    if (val)
      return val;
	}
	return false;
}

//console.log(convert("頭髮", ["zh2CN", "zh2Hans"]));